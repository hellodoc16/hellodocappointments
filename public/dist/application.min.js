"use strict";var ApplicationConfiguration=function(){var applicationModuleName="mean",applicationModuleVendorDependencies=["ngResource","ngAnimate","ngCookies","ui.router","ui.bootstrap","ui.utils","GoogleCalendarService","EventUtil","ui.timepicker","ngMaterial","angularMoment","angular-input-stars","angularFileUpload"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode(!0).hashPrefix("!")}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["$rootScope","$state","Authentication",function($rootScope,$state,Authentication){$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if(toState.data&&toState.data.roles&&toState.data.roles.length>0){var allowed=!1;toState.data.roles.forEach(function(role){if(void 0!==Authentication.user.roles&&Authentication.user.roles.indexOf(role)!==-1)return allowed=!0,!0}),allowed||(event.preventDefault(),$state.go("authentication.signin",{},{notify:!1}).then(function(){$rootScope.$broadcast("$stateChangeSuccess","authentication.signin",{},toState,toParams)}))}}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$state.previous={state:fromState,params:fromParams,href:$state.href(fromState,fromParams)}})}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("core.admin",["core"]),ApplicationConfiguration.registerModule("core.admin.routes",["ui.router"]),ApplicationConfiguration.registerModule("events"),ApplicationConfiguration.registerModule("patients"),ApplicationConfiguration.registerModule("personals"),ApplicationConfiguration.registerModule("users",["core"]),ApplicationConfiguration.registerModule("users.admin",["core.admin"]),ApplicationConfiguration.registerModule("users.admin.routes",["core.admin.routes"]),angular.module("core.admin").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Admin",state:"admin",type:"dropdown",roles:["admin"]})}]),angular.module("core.admin.routes").config(["$stateProvider",function($stateProvider){$stateProvider.state("admin",{abstract:!0,url:"/admin",template:"<ui-view/>",data:{roles:["admin"]}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("not-found"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"}).state("bookappointment",{url:"/bookappointment",templateUrl:"modules/core/views/book.client.view.html"}).state("not-found",{url:"/not-found",templateUrl:"modules/core/views/404.client.view.html"})}]);var coreApp=angular.module("core");coreApp.controller("BookController",["$scope","prsnlService",function($scope,prsnlService){$scope.dentist=prsnlService.getDentist(),$scope.treatment=prsnlService.getTreatment()}]),angular.module("core").controller("HeaderController",["$scope","$state","Authentication","Menus",function($scope,$state,Authentication,Menus){$scope.$state=$state,$scope.authentication=Authentication,$scope.menu=Menus.getMenu("topbar"),$scope.isCollapsed=!1,$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","$location","$controller","$timeout","$q","Personals","ApptTypes","prsnlService",function($scope,$location,$controller,$timeout,$q,Personals,ApptTypes,prsnlService){function queryPrsnlSearch(query){var results=query?prsnl.personals.filter(createFilterFor(query)):prsnl.personals,deferred=$q.defer();return $timeout(function(){deferred.resolve(results)},1e3*Math.random(),!1),deferred.promise}function createFilterFor(query){var lowercaseQuery=angular.lowercase(query);return function(personal){return 0===angular.lowercase(personal.fName).indexOf(lowercaseQuery)}}function selectedPrsnlChange(item){item?appt.apptTypes=item.treatments:appt.apptTypes=ApptTypes.query()}function queryApptSearch(query){var results=query?appt.apptTypes.filter(createFilterForAppt(query)):appt.apptTypes,deferred=$q.defer();return $timeout(function(){deferred.resolve(results)},1e3*Math.random(),!1),deferred.promise}function createFilterForAppt(query){var lowercaseQuery=angular.lowercase(query);return function(apptType){return 0===angular.lowercase(apptType.description).indexOf(lowercaseQuery)}}function selectedApptChange(item){item?prsnl.personals=queryPrsnlSearchByWOTimeOut(item.description):prsnl.personals=Personals.query()}function queryPrsnlSearchByWOTimeOut(query){var results=query?prsnl.personalsAll.filter(createFilterByTreatment(query)):prsnl.personalsAll;return results}function createFilterByTreatment(query){return function(personal){if(personal){var result=!1;return angular.forEach(personal.treatments,function(value,key){0===value.description.indexOf(query)&&(result=!0)}),result}}}$scope.go=function(path){$location.path(path)},$scope.nextPage=function(){prsnlService.addDentist(prsnl.selectedPrsnl),prsnlService.addTreatment(appt.selectedAppt),prsnl.selectedPrsnl&&appt.selectedAppt?$location.path("/bookappointment"):alert("Please select both Treatment & Doctor")};var prsnl=this;prsnl.personals=Personals.query(),prsnl.personalsAll=prsnl.personals,prsnl.selectedPrsnl=null,prsnl.searchPrsnl=null,prsnl.simulateQuery=!1,prsnl.isDisabled=!1,prsnl.queryPrsnlSearch=queryPrsnlSearch,prsnl.selectedPrsnlChange=selectedPrsnlChange;var appt=this;appt.apptTypes=ApptTypes.query(),appt.selectedAppt=null,appt.searchAppt=null,appt.queryApptSearch=queryApptSearch,appt.selectedApptChange=selectedApptChange}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exist")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,options){return options=options||{},this.menus[menuId]={isPublic:null===options.isPublic||"undefined"==typeof options.isPublic||options.isPublic,roles:options.roles||this.defaultRoles,items:options.items||[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,options){if(options=options||{},this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:options.title||"",state:options.state||"",type:options.type||"item",class:options.class,isPublic:null===options.isPublic||"undefined"==typeof options.isPublic?this.menus[menuId].isPublic:options.isPublic,roles:null===options.roles||"undefined"==typeof options.roles?this.menus[menuId].roles:options.roles,position:options.position||0,items:[],shouldRender:shouldRender}),options.items)for(var i in options.items)this.addSubMenuItem(menuId,options.link,options.items[i]);return this.menus[menuId]},this.addSubMenuItem=function(menuId,parentItemState,options){options=options||{},this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].state===parentItemState&&this.menus[menuId].items[itemIndex].items.push({title:options.title||"",state:options.state||"",isPublic:null===options.isPublic||"undefined"==typeof options.isPublic?this.menus[menuId].items[itemIndex].isPublic:options.isPublic,roles:null===options.roles||"undefined"==typeof options.roles?this.menus[menuId].items[itemIndex].roles:options.roles,position:options.position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar",{isPublic:!1})}]);var coreApp=angular.module("core");coreApp.factory("prsnlService",function(){var selectedDentist=[],selectedTreatment=[],addDentist=function(dentist){selectedDentist=dentist},addTreatment=function(treatment){selectedTreatment=treatment},getDentist=function(){return selectedDentist},getTreatment=function(){return selectedTreatment};return{addDentist:addDentist,getDentist:getDentist,selectedDentist:selectedDentist,addTreatment:addTreatment,getTreatment:getTreatment,selectedTreatment:selectedTreatment}}),angular.module("core").service("Socket",["Authentication","$state","$timeout",function(Authentication,$state,$timeout){this.connect=function(){Authentication.user&&(this.socket=io())},this.connect(),this.on=function(eventName,callback){this.socket&&this.socket.on(eventName,function(data){$timeout(function(){callback(data)})})},this.emit=function(eventName,data){this.socket&&this.socket.emit(eventName,data)},this.removeListener=function(eventName){this.socket&&this.socket.removeListener(eventName)}}]),angular.module("events",["ui.calendar"]).run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Appointments",state:"events.main"})}]),angular.module("events").config(["$stateProvider",function($stateProvider){$stateProvider.state("events",{abstract:!0,url:"/events",template:"<ui-view/>",data:{roles:["user","admin"]}}).state("events.main",{url:"/main",templateUrl:"modules/events/views/events.client.view.html"}).state("events.list",{templateUrl:"modules/events/views/list-events.client.view.html"}).state("events.calendar",{templateUrl:"modules/events/views/calendar-events.client.view.html"}).state("events.create",{url:"/createappointment",templateUrl:"modules/events/views/create-events.client.view.html"})}]);var eventCreateApp=angular.module("events");eventCreateApp.controller("EventsCreateController",["$scope","$googleCalendar","$location","$log","$filter","$compile","prsnlService","$mdDialog","$mdMedia","$rootScope",function($scope,$googleCalendar,$location,$log,$filter,$compile,prsnlService,$mdDialog,$mdMedia,$rootScope){function DialogController($scope,$mdDialog,prsnlService){$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.selectedDentist=prsnlService.getDentist(),$scope.selectedTreatment=prsnlService.getTreatment(),$scope.displayName=$rootScope.patient,$scope.displayDateTime=$rootScope.dateTime,$scope.displayTime=$rootScope.endTime}$scope.events=[],this.selectedDentist=prsnlService.getDentist(),this.selectedTreatment=prsnlService.getTreatment(),$scope.myDate=new Date,$scope.minDate=new Date,$scope.maxDate=new Date($scope.myDate.getFullYear(),$scope.myDate.getMonth()+2,$scope.myDate.getDate()),$.datepicker.setDefaults({showOn:"both",buttonImageOnly:!0,buttonImage:"calendar.gif",buttonText:"Calendar"}),$scope.items=["Asthma","High Blood Presure","Bleeding Disorder","Heart Disease","Diabetes"],$scope.patientSelectedMedicalCondition=[],$scope.toggle=function(item,list){var idx=list.indexOf(item);idx>-1?list.splice(idx,1):list.push(item)},$scope.exists=function(item,list){return list.indexOf(item)>-1},this.addEvent=function(){console.log("Start Time:",$scope.event.startTime);var time=$scope.event.startTime.match(/^(\d+)([:\.](\d\d))?\s*((a|(p))m?)?$/i);if(null===time)return null;var m=parseInt(time[3],10)||0,hours=parseInt(time[1],10);time[4]&&(time[4]=time[4].toLowerCase()),12!==hours||time[4]?12!==hours||"am"!==time[4]&&"a"!==time[4]?hours<12&&"am"!==time[4]&&"a"!==time[4]?hours+=12:hours>24&&hours.toString().length>=3&&(3===hours.toString().length?(m=parseInt(hours.toString().substring(1,3),10),hours=parseInt(hours.toString().charAt(0),10)):4===hours.toString().length&&(m=parseInt(hours.toString().substring(2,4),10),hours=parseInt(hours.toString().substring(0,2),10))):hours+=12:hours=12,$scope.event.startDate.setHours(hours),$scope.event.startDate.setMinutes(m),console.log("Start Date:",$scope.event.startDate);var endDate=new Date($scope.event.startDate);endDate.setMinutes(endDate.getMinutes()+this.selectedTreatment.duration),console.log("End Date:",endDate),$scope.patientInfo={patientName:$scope.event.patientName,patientAge:$scope.event.patientAge,patientGender:$scope.event.patientGender,patientPlace:$scope.event.patientPlace,contact:$scope.event.patientPhoneNumber,emailId:$scope.event.patientEmail,patientSelectedMedicalCondition:$scope.patientSelectedMedicalCondition,patientChiefComplaint:$scope.event.patientChiefComplaint},$rootScope.patient=$scope.patientInfo.patientName,$rootScope.dateTime=$scope.event.startDate,$rootScope.endTime=endDate;var contactInfo={doctorName:this.selectedDentist.fName+" "+this.selectedDentist.lName,emailId:this.selectedDentist.emailId,treatment:this.selectedTreatment.description};$googleCalendar.addEvent($scope.event.startDate,endDate,contactInfo,$scope.patientInfo).then(function(result){console.log("Add Event Result:",result),$scope.showSuccess()},function(result){$scope.showFailed()})},this.updateTime=function(){$scope.notavailable="";var _date=$filter("date")(new Date($scope.event.startDate),"EEEE");$("#timePick").timepicker("remove");var startDate=new Date($scope.event.startDate);startDate.setHours(0,0,0,0);var endDate=new Date($scope.event.startDate);endDate.setHours(23,59,59,999);for(var index=0;index<this.selectedDentist.slots.length;index++){var slot=this.selectedDentist.slots[index];if($scope.event.minTime=$filter("date")(new Date(slot.starttime),"shortTime"),$scope.event.maxTime=$filter("date")(new Date(slot.endtime),"shortTime"),$scope.event.step=this.selectedTreatment.duration,slot.day===_date){$googleCalendar.getEventByUser(this.selectedDentist,startDate,endDate).then(function(events){var eventArray=[];events.forEach(function(element){var event=[];event.push(new Date(element.start.dateTime).toLocaleTimeString()),event.push(new Date(element.end.dateTime).toLocaleTimeString()),eventArray.push(event)},this),$(document).ready(function(){$("#timePick").timepicker({minTime:$scope.event.minTime,maxTime:$scope.event.maxTime,step:"15",disableTextInput:!0,timeFormat:"g:ia",disableTimeRanges:eventArray})})}),$scope.notavailable="";break}$scope.notavailable="No Slots Available for the selected date"}},DialogController.$inject=["$scope","$mdDialog","prsnlService"],$scope.showFailed=function(){var useFullScreen=($mdMedia("sm")||$mdMedia("xs"))&&$scope.customFullscreen;$mdDialog.show({controller:DialogController,templateUrl:"modules/events/views/failed.tmpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:useFullScreen}).then(function(answer){$location.path("/")},function(){$location.path("/")}),$scope.$watch(function(){return $mdMedia("xs")||$mdMedia("sm")},function(wantsFullScreen){$scope.customFullscreen=wantsFullScreen===!0})},$scope.showSuccess=function(){var useFullScreen=($mdMedia("sm")||$mdMedia("xs"))&&$scope.customFullscreen;$mdDialog.show({controller:DialogController,templateUrl:"modules/events/views/success.tmpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:useFullScreen}).then(function(answer){$location.path("/")},function(){$location.path("/")}),$scope.$watch(function(){return $mdMedia("xs")||$mdMedia("sm")},function(wantsFullScreen){$scope.customFullscreen=wantsFullScreen===!0})}}]);var eventsApp=angular.module("events");eventsApp.controller("EventsController",["$scope","$googleCalendar","$uibModal","$log","$mdSidenav",function($scope,$googleCalendar,$uibModal,$log,$mdSidenav){$scope.events=[],$scope.calEvents=[],$scope.eventSources=[],$scope.isCalendarView=!0,$scope.isTableView=!1,$scope.isSidenavOpen=!1,$scope.uiConfig={calendar:{schedulerLicenseKey:"GPL-My-Project-Is-Open-Source",editable:!1,aspectRatio:1.5,header:{left:"month,agendaWeek,agendaDay,verticalResourceView",center:"title",right:"today prev,next"},eventLimit:!0,navLinks:!0,views:{verticalResourceView:{type:"timeline",duration:{days:1},buttonText:"day by doctor"},agendaDay:{resources:!1}},minTime:"8:00",maxTime:"21:00",resourceAreaWidth:"20%",resourceLabelText:"Doctors",resources:[{id:"Dr. Siddharth Kumar",title:"Dr. Siddharth Kumar",eventColor:"maroon"},{id:"Yunus Tonse",title:"Yunus Tonse",eventColor:"green"},{id:"Dr Sanket Seth",title:"Dr Sanket Seth",eventColor:"#FF00FF"},{id:"Dr. Manoj DLima",title:"Dr. Manoj DLima",eventColor:"orange"},{id:"Dr Venugopal H",title:"Dr Venugopal H",eventColor:"red"},{id:"Dr Ajay Prabhu",title:"Dr Ajay Prabhu",eventColor:"lime"},{id:"Dr Pradeep Kharvi",title:"Dr Pradeep Kharvi",eventColor:"purple"},{id:"Dr Rajaram Shetty",title:"Dr Rajaram Shetty",eventColor:"#9ACD32"},{id:"Dr Sudhir Rao",title:"Dr Sudhir Rao",eventColor:"maroon"},{id:"Dr Puneeth Hegde",title:"Dr Puneeth Hegde",eventColor:"black"},{id:"Dr Dilip Quadras",title:"Dr Dilip Quadras",eventColor:"#FF00FF"},{id:"Dr Syed Mustafa Hasani",title:"Dr Syed Mustafa Hasani",eventColor:"#0000FF"},{id:"Dr Gururaj Krishnamurthy",title:"Dr Gururaj Krishnamurthy",eventColor:"#00FFFF"},{id:"Dr Shinaj Kumar",title:"Dr Shinaj Kumar",eventColor:"#FFC0CB"},{id:"Dr Syed Faiz",title:"Dr Syed Faiz",eventColor:"#BDB76B"},{id:"Name: Dr Shahinda Ismail",title:"Name: Dr Shahinda Ismail",eventColor:"#00BFFF"},{id:"Dr Manav Kalra",title:"Dr Manav Kalra",eventColor:"#9ACD32"},{id:"Dr Bennete Fernandes",title:"Dr Bennete Fernandes",eventColor:"#FFFFE0"},{id:"Dr Nikhil Mahajan",title:"Dr Nikhil Mahajan",eventColor:"#B8860B"},{id:"Dr Shilpa Gangwar",title:"Dr Shilpa Gangwar",eventColor:"maroon"},{id:"Dr Reshma Mehta",title:"Dr Reshma Mehta",eventColor:"green"},{id:"Dr Pradeep Vighne",title:"Dr Pradeep Vighne",eventColor:"#FF00FF"},{id:"Dr Ayush Srivastava",title:"Dr Ayush Srivastava",eventColor:"orange"},{id:"Dr Richa Vajpeyee",title:"Dr Richa Vajpeyee",eventColor:"red"},{id:"Dr Amaey Parekh",title:"Dr Amaey Parekh",eventColor:"lime"},{id:"Dr Ankit Jha",title:"Dr Ankit Jha",eventColor:"purple"},{id:"Dr Akhilesh Kaushik",title:"Dr Akhilesh Kaushik",eventColor:"#9ACD32"},{id:"Dr Ritu Gupta",title:"Dr Ritu Gupta",eventColor:"maroon"},{id:"Dr Henal Gandhi",title:"Dr Henal Gandhi",eventColor:"black"},{id:"Dr Seema Herle",title:"Dr Seema Herle",eventColor:"#FF00FF"},{id:"Dr Namitha P. Kamath",title:"Dr Namitha P. Kamath",eventColor:"#0000FF"},{id:"Dr Prashanth Ramachandra",title:"Dr Prashanth Ramachandra",eventColor:"#00FFFF"},{id:"Dr Tanvi Patil",title:"Dr Tanvi Patil",eventColor:"#FFC0CB"},{id:"Dr Sonali Das",title:"Dr Sonali Das",eventColor:"#BDB76B"},{id:"Dr Samir Kumar Praharaj",title:"Dr Samir Kumar Praharaj",eventColor:"#00BFFF"},{id:"Dr Raghavan Sreevatsan",title:"Dr Raghavan Sreevatsan",eventColor:"#9ACD32"},{id:"Dr.Evit John",title:"Dr.Evit John",eventColor:"#FFFFE0"},{id:"Rajamma Sister",title:"Rajamma Sister",eventColor:"#B8860B"},{id:"Dr Sandeep Pai",title:"Dr Sandeep Pai",eventColor:"maroon"},{id:"Dr Akshay",title:"Dr Akshay",eventColor:"green"},{id:"Dr Ganesh Kamath",title:"Dr Ganesh Kamath",eventColor:"#FF00FF"},{id:"Dr Sunil & Team",title:"Dr Sunil & Team",eventColor:"orange"},{id:"Dr. Rajesh",title:"Dr. Rajesh",eventColor:"red"},{id:"Dr Preeti",title:"Dr Preeti",eventColor:"lime"},{id:"Dr Avinash",title:"Dr Avinash",eventColor:"purple"},{id:"Dr. Ramesh S. Ve",title:"Dr. Ramesh S. Ve",eventColor:"#9ACD32"},{id:"Dr Khushboo",title:"Dr Khushboo",eventColor:"maroon"},{id:"Dr. Vishwanath",title:"Dr. Vishwanath",eventColor:"black"},{id:"Dr. Radhika SOAHS",title:"Dr. Radhika SOAHS",eventColor:"#FF00FF"},{id:"Dr Varsha",title:"Dr Varsha",eventColor:"#0000FF"},{id:"Dr nagraj p g optom",title:"Dr nagraj p g optom",eventColor:"#00FFFF"},{id:"Dr Pooja",title:"Dr Pooja",eventColor:"#FFC0CB"},{id:"Dr Aishwarya S",title:"Dr Aishwarya S",eventColor:"#BDB76B"},{id:"Dr Dr Aishwarya Shetty",title:"Dr Aishwarya Shetty",eventColor:"#00BFFF"},{id:"Dr Apoorva",title:"Dr Apoorva",eventColor:"#9ACD32"},{id:"Dr.Suresh Shenoy",title:"Dr.Suresh Shenoy",eventColor:"#FFFFE0"},{id:"Dr.Priyanka Agarwal",title:"Dr.Priyanka Agarwal",eventColor:"#B8860B"},{id:"Dr N Prakash",title:"Dr N Prakash",eventColor:"#9ACD32"},{id:"Dr Mayank Sharma",title:"Dr Mayank Sharma",eventColor:"#FFFFE0"},{id:"Dr.Shrey Dhawan",title:"Dr.Shrey Dhawan",eventColor:"#B8860B"}],eventRender:function(event,element){var view=$("#calendar").fullCalendar("getView");"verticalResourceView"===view.name?(element.find(".fc-title").empty(),element.find(".fc-title").append(event.description.split("\n")[0])):(element.find(".fc-title").empty(),"On Vacation"===event.description?element.find(".fc-title").append("On Vacation - "+event.title):element.find(".fc-title").append(event.title))},eventClick:$scope.alertOnEventClick}},this.toggleview=function(){$scope.isCalendarView===!0?($scope.isCalendarView=!1,$scope.isTableView=!0):($scope.isCalendarView=!0,$scope.isTableView=!1)},$scope.alertOnEventClick=function(date,jsEvent,view){$scope.currentEvent=date,$mdSidenav("right").toggle()},$scope.getEvents=function(){$googleCalendar.getEvents().then(function(events,eventRender){$scope.events=events;for(var index=0;index<events.length;index++){var event=events[index];$scope.calEvents[index]={title:event.summary,start:event.start.dateTime,end:event.end.dateTime,description:event.description,resourceId:event.summary,stick:"true"},console.log(event.summary)}})},$scope.eventSources=[$scope.calEvents],$scope.setCurrentEvent=function(event){$scope.currentEvent=event},$scope.myFilter=function(event){return"On Vacation"!==event.description}}]),angular.module("EventUtil",[]).factory("broadcast",["$rootScope",function($rootScope){return function(eventName,payload){$rootScope.$broadcast(eventName,payload)}}]).factory("listenTo",["$rootScope",function($rootScope){return function(eventName,listener){$rootScope.$on(eventName,listener)}}]),angular.module("GoogleCalendarService",[],["$provide",function($provide){$provide.factory("$googleCalendar",["$http","$q","$location",function($http,$q,$location){var $scope=angular.element(document).scope(),baseUrl=$location.protocol()+"://"+location.host;return{getEventByUser:function(user,startDate,endDate){var defer=$q.defer(),jsonData={params:{startdate:startDate,enddate:endDate,user:user.fName+" "+user.lName}};return $http.get(baseUrl+"/api/getEventByUser",jsonData).then(function(response){200===response.status?($scope.$broadcast("GoogleEventsReceived",response.data.items),defer.resolve(response.data.items),console.log(response.data.items)):($scope.$broadcast("GoogleError",response.data),defer.reject(response.data))}),defer.promise},getEvents:function(){var defer=$q.defer();return $http.get(baseUrl+"/api/events").then(function(response){200===response.status?($scope.$broadcast("GoogleEventsReceived",response.data.items),defer.resolve(response.data.items),console.log(response.data.items)):($scope.$broadcast("GoogleError",response.data),defer.reject(response.data))}),defer.promise},addEvent:function(scheduledDate,endDate,contactInfo,patientInfo){var defer=$q.defer(),postData={startdate:scheduledDate,enddate:endDate,personal:contactInfo,patient:patientInfo};return $http.post(baseUrl+"/api/events",postData,{"Content-Type":"application/json"}).then(function(response){200===response.status?($scope.$broadcast("eventAddedSuccess",response.data),defer.resolve(response.data)):(console.log(response.data),$scope.$broadcast("GoogleError",response.data),defer.reject(response.data))},function(response){console.log(response.data),$scope.$broadcast("GoogleError",response.data),defer.reject(response.data)}),defer.promise}}}])}]),angular.module("patients",["multipleSelect","mgcrea.ngStrap","ngMaterial","ui.bootstrap"]).run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Patient Information",state:"patients.main"})}]),angular.module("patients").config(["$stateProvider",function($stateProvider){$stateProvider.state("patients",{abstract:!0,url:"/patients",template:"<ui-view/>",data:{roles:["user","admin"]}}).state("patients.main",{url:"/main",templateUrl:"modules/patients/views/list-patients.client.view.html"})}]);var patientApp=angular.module("patients");patientApp.controller("PatientsController",["$scope","Patients",function($scope,Patients){function setPagingData(page){if(patients&&patients.length>0){var pagedData=patients.slice((page-1)*$scope.itemsPerPage,page*$scope.itemsPerPage);$scope.patients=pagedData}}var patients;Patients.query(function(result){$scope.patients=result,patients=$scope.patients,$scope.totalItems=$scope.patients.length,$scope.currentPage=1,$scope.itemsPerPage=20}),$scope.$watch("currentPage",function(){setPagingData($scope.currentPage)})}]),angular.module("patients").factory("Patients",["$resource",function($resource){return $resource("api/patients/:patientId",{patientId:"@_id"},{update:{method:"PUT"}})}]),angular.module("personals",["multipleSelect","mgcrea.ngStrap","ngMaterial"]).run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Admin",state:"personals",type:"dropdown",roles:["user"]}),Menus.addSubMenuItem("topbar","personals",{title:"CareGivers",state:"personals.list"}),Menus.addSubMenuItem("topbar","personals",{title:"Treatment Types",state:"personals.appttypelist"})}]),angular.module("personals").config(["$stateProvider",function($stateProvider){$stateProvider.state("personals",{abstract:!0,url:"/personals",template:"<ui-view/>",data:{roles:["user","admin"]}}).state("personals.list",{url:"",templateUrl:"modules/personals/views/list-personals.client.view.html"}).state("personals.appttypelist",{url:"/appointmenttypes",templateUrl:"modules/personals/views/list-appttypes.client.view.html"})}]);var personalsApp=angular.module("personals");personalsApp.controller("ApptSlotController",["$scope","slotService",function($scope,slotService){$scope.slotList=slotService.slotList,$scope.slot=[],$scope.disabled=!1,$scope.dayOptions=[{label:"Monday"},{label:"Tuesday"},{label:"Wednesday"},{label:"Thursday"},{label:"Friday"},{label:"Saturday"},{label:"Sunday"}];var refresh=function(personal){console.log(personal),slotService.slotList=personal.slots,$scope.slot="",$scope.disabled=!1};$scope.addSlots=function(){console.log(slotService.slotList),slotService.slotList.push({day:$scope.slot.selectedDay.label,location:$scope.slot.location,starttime:$scope.slot.starttime,endtime:$scope.slot.endtime}),$scope.slotList=slotService.slotList},$scope.remove=function(personal,slot){if(slot)for(var i in this.slotList)this.slotList[i]===slot&&this.slotList.splice(i,1);else this.slot.$remove(function(){})},$scope.update=function(personal){personal.slots=[];for(var index=0;index<slotService.slotList.length;index++)personal.slots.push({day:slotService.slotList[index].day,starttime:slotService.slotList[index].starttime,endtime:slotService.slotList[index].endtime,location:slotService.slotList[index].location});personal.$update(function(){refresh(personal)},function(errorResponse){$scope.error=errorResponse.data.message,console.log(errorResponse.data.message)})},$scope.edit=function(slot){for(var i in this.slotList)this.slotList[i]===slot&&($scope.slot=slot);$scope.disabled=!0},$scope.deselect=function(){$scope.slot="",$scope.disabled=!1}}]);var personalsApp=angular.module("personals");personalsApp.controller("ApptSlotBlockController",["$scope",function($scope){$scope.myDate=new Date,$scope.minDate=new Date($scope.myDate.getFullYear(),$scope.myDate.getMonth(),$scope.myDate.getDate()),$scope.blockCalendar=function(){$scope.slot.push({startdate:$scope.slot.startdate,enddate:$scope.slot.enddate})}}]);var personalsApp=angular.module("personals");personalsApp.controller("ApptTypeController",["$scope","ApptTypes",function($scope,ApptTypes){$scope.procedureList=[],$scope.procedure=[],$scope.disabled=!1;var refresh=function(){$scope.procedureList=ApptTypes.query(),$scope.procedure=[],$scope.disabled=!1};refresh(),$scope.addProcedure=function(){var apptType=new ApptTypes({description:$scope.procedure.description,duration:$scope.procedure.duration,price:$scope.procedure.price,longDescription:$scope.procedure.longDescription});apptType.$save(function(response){$scope.procedure.description="",$scope.procedure.duration="",$scope.procedure.price="",$scope.procedure.longDescription="",refresh()},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(procedure){if(confirm("Are you sure you want to delete this procedure?"))if(procedure){procedure.$remove();for(var i in this.procedureList)this.procedureList[i]===procedure&&this.procedureList.splice(i,1)}else this.procedure.$remove(function(){})},$scope.update=function(updtprocedure){var procedure=updtprocedure;procedure.$update(function(){refresh()},function(errorResponse){$scope.error=errorResponse.data.message,console.log(errorResponse.data.message)})},$scope.edit=function(procedure){for(var i in this.procedureList)this.procedureList[i]===procedure&&($scope.procedure=procedure);$scope.disabled=!0},$scope.deselect=function(){$scope.procedure=[],$scope.disabled=!1}}]);var personalsApp=angular.module("personals");personalsApp.controller("PersonalsCreateController",["$scope","Personals","Notify","$timeout","$window","Authentication","FileUploader",function($scope,Personals,Notify,$timeout,$window,Authentication,FileUploader){var personal=[];this.CreatePrsnl=function(){personal=new Personals({fName:this.fName,lName:this.lName,emailId:this.emailId,contact:this.contact,isConsultant:this.isConsultant,regNumber:this.regNumber,speciality:this.speciality,qualification:this.qualification,experience:this.experience,rating:this.rating,treatments:this.selectedTreatments,slots:this.slots,profileImageURL:this.profileImageURL}),personal.$save(function(response){$scope.fName="",$scope.lName="",$scope.emailId="",$scope.contact="",$scope.isConsultant="",$scope.regNumber="",$scope.speciality="",$scope.qualification="",$scope.experience="",$scope.rating=null,$scope.selectedTreatments=null,$scope.slots=null,$scope.profileImageURL=null,$scope.file=null,Notify.sendMsg("NewPersonal",{id:response._id})},function(errorResponse){$scope.error=errorResponse.data.message}),$scope.success=$scope.error=null,$scope.uploader.uploadAll()},$scope.uploader=new FileUploader({url:"/api/personal/picture",alias:"personalProfilePicture"}),$scope.uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}},$scope.uploader.onSuccessItem=function(fileItem,response,status,headers){$scope.success=!0,personal.profileImageURL=response.profileImageURL,
personal.$save(function(response){personal=null,Notify.sendMsg("NewPersonal",{id:response._id})},function(errorResponse){$scope.error=errorResponse.data.message}),$scope.cancelUpload()},$scope.uploader.onErrorItem=function(fileItem,response,status,headers){$scope.cancelUpload(),$scope.error=response.message},$scope.cancelUpload=function(){$scope.uploader.clearQueue(),$scope.profileImageURL}}]);var personalsApp=angular.module("personals");personalsApp.controller("PersonalsUpdateController",["$scope","$timeout","$window","Authentication","FileUploader",function($scope,$timeout,$window,Authentication,FileUploader){this.rating=1,this.rateFunction=function(rating){alert("Rating selected - "+rating)};var personal=[];this.UpdatePrsnl=function(updtpersonal){personal=updtpersonal,personal.$update(function(){},function(errorResponse){}),$scope.success=$scope.error=null,$scope.uploader.uploadAll()},$scope.uploader=new FileUploader({url:"/api/personal/picture",alias:"personalProfilePicture"}),$scope.uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.personal.profileImageURL=fileReaderEvent.target.result},0)}}},$scope.uploader.onSuccessItem=function(fileItem,response,status,headers){$scope.success=!0,personal.profileImageURL=response.profileImageURL,personal.$update(function(){},function(errorResponse){$scope.error=errorResponse.data.message,console.log(errorResponse.data.message)}),$scope.cancelUpload()},$scope.uploader.onErrorItem=function(fileItem,response,status,headers){$scope.cancelUpload(),$scope.error=response.message},$scope.cancelUpload=function(){$scope.uploader.clearQueue(),$scope.profileImageURL}}]);var personalsApp=angular.module("personals");personalsApp.directive("onErrorSrc",function(){return{link:function(scope,element,attrs){element.bind("error",function(){attrs.src!==attrs.onErrorSrc&&attrs.$set("src",attrs.onErrorSrc)})}}}),personalsApp.controller("PersonalsController",["$scope","$stateParams","Personals","$uibModal","$log","$q","slotService","$mdDialog","$mdMedia","$googleCalendar","$mdToast",function($scope,$stateParams,Personals,$uibModal,$log,$q,slotService,$mdDialog,$mdMedia,$googleCalendar,$mdToast){this.personals=Personals.query(),console.log(this.personals),this.modelCreate=function(size){var modalInstance=$uibModal.open({animation:$scope.animationsEnabled,templateUrl:"modules/personals/views/create-personal.client.view.html",controller:function($scope,$uibModalInstance){$scope.ok=function(){$uibModalInstance.close($scope.personal)},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}},size:size});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})},this.modelUpdate=function(size,selectedPersonal){for(var elements=[],index=0;index<selectedPersonal.treatments.length;index++){var element=selectedPersonal.treatments[index];elements[index]={description:element.description,duration:element.duration,price:element.price,longDescription:element.longDescription,checked:!0}}selectedPersonal.treatments=elements,console.log(selectedPersonal);var modalInstance=$uibModal.open({animation:$scope.animationsEnabled,templateUrl:"modules/personals/views/edit-personal.client.view.html",controller:function($scope,$uibModalInstance,selectedPersonal){$scope.personal=selectedPersonal,$scope.ok=function(){$uibModalInstance.close($scope.personal)},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}},size:size,resolve:{selectedPersonal:function(){return selectedPersonal}}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){})},this.modelSchedule=function(size,selectedPersonal){var modalInstance=$uibModal.open({animation:$scope.animationsEnabled,templateUrl:"modules/personals/views/list-apptslots.client.view.html",controller:function($scope,$uibModalInstance,selectedPersonal,slotService){$scope.personal=selectedPersonal,slotService.slotList=selectedPersonal.slots,$scope.ok=function(){$uibModalInstance.close($scope.personal)},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}},size:size,resolve:{selectedPersonal:function(){return selectedPersonal}}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){})},this.remove=function(personal){if(confirm("Are you sure you want to delete this user?"))if(personal){personal.$remove();for(var i in this.personals)this.personals[i]===personal&&this.personals.splice(i,1)}else this.personal.$remove(function(){})},this.modelBlock=function(selectedPersonal){function DialogController($scope,$mdDialog,personal,$googleCalendar,$mdToast){$scope.personal=personal,$scope.myDate=new Date,$scope.minDate=new Date($scope.myDate.getFullYear(),$scope.myDate.getMonth(),$scope.myDate.getDate()),$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.blockCalendar=function(personal){var startDate=new Date($scope.startDate);startDate.setHours(0,0,0,0);var endDate=new Date($scope.endDate);endDate.setHours(23,59,59,999),$googleCalendar.addEvent(startDate,endDate,personal,null).then(function(result){$mdToast.show($mdToast.simple().textContent("Successfully Appointment Slot Blocked!").position("top right").hideDelay(3e3)),console.log("Add Event Result:",result)},function(result){$mdToast.show($mdToast.simple().textContent("Unable to block the Appointment Slot!").position("top right").hideDelay(3e3)),console.log("Failed Event Result:",result)}),$mdDialog.hide()}}DialogController.$inject=["$scope","$mdDialog","personal","$googleCalendar","$mdToast"];var useFullScreen=($mdMedia("sm")||$mdMedia("xs"))&&$scope.customFullscreen;$mdDialog.show({controller:DialogController,templateUrl:"modules/personals/views/list-apptslotsblock.client.view.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:useFullScreen,locals:{personal:selectedPersonal}}),$scope.$watch(function(){return $mdMedia("xs")||$mdMedia("sm")},function(wantsFullScreen){$scope.customFullscreen=wantsFullScreen===!0})}}]);var personalsApp=angular.module("personals");personalsApp.directive("listPersonal",["Personals","Notify",function(Personals,Notify){return{restrict:"E",transclude:!0,templateUrl:"modules/personals/views/view-personal.client.view.html",link:function($scope,element,attrs){Notify.getMsg("NewPersonal",function(event,data){$scope.personalsCtrl.personals=Personals.query()})}}}]);var personalsApp=angular.module("personals");personalsApp.factory("slotService",function(){var slotList=[],addSlot=function(newObj){slotList.push(newObj)},getSlots=function(){return slotList};return{addSlot:addSlot,getSlots:getSlots,slotList:slotList}}),angular.module("personals").factory("Personals",["$resource",function($resource){return $resource("api/personals/:personalId",{personalId:"@_id"},{update:{method:"PUT"}})}]).factory("ApptTypes",["$resource",function($resource){return $resource("api/appttypes/:appttypeId",{appttypeId:"@_id"},{update:{method:"PUT"}})}]).factory("Notify",["$rootScope",function($rootScope){var notify={};return notify.sendMsg=function(msg,data){data=data||{},$rootScope.$emit(msg,data),console.log("message sent!")},notify.getMsg=function(msg,func,scope){var unbind=$rootScope.$on(msg,func);scope&&scope.$on("destroy",unbind)},notify}]),angular.module("users.admin").run(["Menus",function(Menus){Menus.addSubMenuItem("topbar","admin",{title:"Manage Users",state:"admin.users"})}]),angular.module("users.admin.routes").config(["$stateProvider",function($stateProvider){$stateProvider.state("admin.users",{url:"/users",templateUrl:"modules/users/views/admin/user-list.client.view.html",controller:"UserListController"}).state("admin.user",{url:"/users/:userId",templateUrl:"modules/users/views/admin/user.client.view.html",controller:"UserController",resolve:{userResolve:["$stateParams","Admin",function($stateParams,Admin){return Admin.get({userId:$stateParams.userId})}]}}).state("admin.user-edit",{url:"/users/:userId/edit",templateUrl:"modules/users/views/admin/user-edit.client.view.html",controller:"UserController",resolve:{userResolve:["$stateParams","Admin",function($stateParams,Admin){return Admin.get({userId:$stateParams.userId})}]}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("settings",{abstract:!0,url:"/settings",templateUrl:"modules/users/views/settings/settings.client.view.html",data:{roles:["user","admin"]}}).state("settings.profile",{url:"/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("settings.password",{url:"/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("settings.accounts",{url:"/accounts",templateUrl:"modules/users/views/settings/manage-social-accounts.client.view.html"}).state("settings.picture",{url:"/picture",templateUrl:"modules/users/views/settings/change-profile-picture.client.view.html"}).state("authentication",{abstract:!0,url:"/authentication",templateUrl:"modules/users/views/authentication/authentication.client.view.html"}).state("authentication.signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("authentication.signin",{url:"/signin?err",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("password",{abstract:!0,url:"/password",template:"<ui-view/>"}).state("password.forgot",{url:"/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("password.reset",{abstract:!0,url:"/reset",template:"<ui-view/>"}).state("password.reset.invalid",{url:"/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("password.reset.success",{url:"/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("password.reset.form",{url:"/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users.admin").controller("UserListController",["$scope","$filter","Admin",function($scope,$filter,Admin){Admin.query(function(data){$scope.users=data,$scope.buildPager()}),$scope.buildPager=function(){$scope.pagedItems=[],$scope.itemsPerPage=15,$scope.currentPage=1,$scope.figureOutItemsToDisplay()},$scope.figureOutItemsToDisplay=function(){$scope.filteredItems=$filter("filter")($scope.users,{$:$scope.search}),$scope.filterLength=$scope.filteredItems.length;var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.pagedItems=$scope.filteredItems.slice(begin,end)},$scope.pageChanged=function(){$scope.figureOutItemsToDisplay()}}]),angular.module("users.admin").controller("UserController",["$scope","$state","Authentication","userResolve",function($scope,$state,Authentication,userResolve){$scope.authentication=Authentication,$scope.user=userResolve,$scope.remove=function(user){confirm("Are you sure you want to delete this user?")&&(user?(user.$remove(),$scope.users.splice($scope.users.indexOf(user),1)):$scope.user.$remove(function(){$state.go("admin.users")}))},$scope.update=function(isValid){if(!isValid)return $scope.$broadcast("show-errors-check-validity","userForm"),!1;var user=$scope.user;user.$update(function(){$state.go("admin.user",{userId:user._id})},function(errorResponse){$scope.error=errorResponse.data.message})}}]),angular.module("users").controller("AuthenticationController",["$scope","$state","$http","$location","$window","Authentication",function($scope,$state,$http,$location,$window,Authentication){$scope.authentication=Authentication,$scope.error=$location.search().err,$scope.authentication.user&&$location.path("/events/main"),$scope.signup=function(){$http.post("/api/auth/signup",$scope.credentials).then(function(response){$scope.authentication.user=response.data,$state.go($state.previous.state.name||"events.main",$state.previous.params)},function(response){$scope.error=response.data.message})},$scope.signin=function(){$http.post("/api/auth/signin",$scope.credentials).then(function(response){$scope.authentication.user=response.data,$state.go($state.previous.state.name||"events.main",$state.previous.params)},function(response){$scope.error=response.data.message})},$scope.callOauthProvider=function(url){var redirect_to;$state.previous&&(redirect_to=$state.previous.href),$window.location.href=url+(redirect_to?"?redirect_to="+encodeURIComponent(redirect_to):"")}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/api/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/api/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("ChangePasswordController",["$scope","$http","Authentication",function($scope,$http,Authentication){$scope.user=Authentication.user,$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/api/users/password",$scope.passwordDetails).then(function(response){$scope.success=!0,$scope.passwordDetails=null},function(response){$scope.error=response.data.message})}}]),angular.module("users").controller("ChangeProfilePictureController",["$scope","$timeout","$window","Authentication","FileUploader",function($scope,$timeout,$window,Authentication,FileUploader){$scope.user=Authentication.user,$scope.imageURL=$scope.user.profileImageURL,$scope.uploader=new FileUploader({url:"api/users/picture",alias:"newProfilePicture"}),$scope.uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}},$scope.uploader.onSuccessItem=function(fileItem,response,status,headers){$scope.success=!0,$scope.user=Authentication.user=response,$scope.cancelUpload()},$scope.uploader.onErrorItem=function(fileItem,response,status,headers){$scope.cancelUpload(),$scope.error=response.message},$scope.uploadProfilePicture=function(){$scope.success=$scope.error=null,$scope.uploader.uploadAll()},$scope.cancelUpload=function(){$scope.uploader.clearQueue(),$scope.imageURL=$scope.user.profileImageURL}}]),angular.module("users").controller("EditProfileController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0}}]),angular.module("users").controller("SocialAccountsController",["$scope","$http","Authentication",function($scope,$http,Authentication){$scope.user=Authentication.user,$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http.delete("/api/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","Authentication",function($scope,Authentication){$scope.user=Authentication.user}]),angular.module("users").factory("Authentication",["$window",function($window){var auth={user:$window.user};return auth}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("api/users",{},{update:{method:"PUT"}})}]),angular.module("users.admin").factory("Admin",["$resource",function($resource){return $resource("api/users/:userId",{userId:"@_id"},{update:{method:"PUT"}})}]);